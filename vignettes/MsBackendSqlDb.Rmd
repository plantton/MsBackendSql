---
title: "Description and usage of MsBackendSqlDb"
output: 
    BiocStyle::html_document:
        toc_float: true
vignette: >
    %\VignetteIndexEntry{Description and usage of MsBackendSqlDb}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
    %\VignettePackage{MsBackendSql}
    %\VignetteDepends{Spectra,mzR,BiocStyle,msdata}
---


```{r style, echo = FALSE, results = 'asis', message = FALSE}
BiocStyle::markdown()
```

**Package**: `r Biocpkg("MsBackendSql")`<br />
**Authors**: `r packageDescription("MsBackendSql")[["Author"]] `<br />
**Last modified:** `r file.info("MsBackendSqlDb.Rmd")$mtime`<br />
**Compiled**: `r date()`


# Introduction

This vignette will briefly introduce the usage of new SQLite based
backend `MsBackendSqlDb`. I will also compare `MsBackendSqlDb` to
`MsBackendDataFrame` to illustrate the similarities.

# Usage

Firstly, we load the relevant packages:

```{r env, message = FALSE}
library(Spectra)
library(RSQLite)
library(msdata)
library(MsBackendSql)
```

# Creating `MsBackendDataFrame` and `MsBackendSqlDb` objects

We will use a small sciex to create the backend objects.

```{r usage1}
fls <- dir(system.file("sciex", package = "msdata"), full.names = TRUE)
b1 <- Spectra(fls, backend = MsBackendMzR())
b1 <- setBackend(b1, MsBackendDataFrame())
b1
```

For `MsBackendSqlDb` backend, we have to create a `connection` object:

```{r usage2}
conn2 <- dbConnect(SQLite(), "b2.db")
b2 <- backendInitialize(MsBackendSqlDb(), dbcon = conn2, files = fls)
b2
```

Can we load the mz and intensity values from the both backends?

```{r comparison1}
mz1 <- mz(b1)
mz2 <- mz(b2)
identical(mz1, mz1)
```


```{r comparison2}
intensity1 <- intensity(b1)
intensity2 <- intensity(b2)
identical(intensity1, intensity2)
```

Now we want to check the subsetting functions:

```{r comparison3}
sub1 <- b1[5:20]
sub2 <- b2[5:20]
sub1
sub2
```

We can reproduce the example from `Spectra` vignette:

```{r comparison4}
b2[b2$dataOrigin == fls[2] &
          b2$rtime >= 175 &
          b2$rtime <= 189]
```

```{r comparison5}
fls <- unique(dataOrigin(b2))
file_2 <- filterDataOrigin(b2, dataOrigin = fls[2])
length(file_2)
```

```{r comparison6}
sps_sub <- filterRt(file_2, rt = c(175, 189))
length(sps_sub)
```

We can also filter intensity values:

```{r comparison7}
filtering1 <- filterIntensity(b2, 1000)
filtering1[[3]]
```

```{r comparison8}
filtering1 <- filterIntensity(b2, c(1000, 2000))
filtering1[[3]]
```

# Session information

```{r}
sessionInfo()
```
